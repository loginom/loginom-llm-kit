# meta-Ollama

[Назад к списку компонентов](../README.md)

## Назначение

Мета-компонент для обращения к **Ollama API**. Включает в себя функционал компонентов [Подключение. Ollama](./connection-ollama.md) и [meta-Запрос к LLM](./docs/meta-llm-request.md).

## Входные порты

| Название  | Тип        |
| :-------- | :--------- |
| Промпты   | Таблица    |
| Реквизиты | Переменные |
| Параметры | Переменные |
| Настройки | Переменные |

### Структура таблицы "Промпты"

| Метка   | Тип                             | Описание               |
| :------ | :------------------------------ | :--------------------- |
| Промпты | ![](./img/string.svg) Строковый | JSON‑массив            |

### Переменные в порте "Реквизиты"

| №   | Метка | Тип                             | Значение по умолчанию           |
| :-- | :---- | :------------------------------ | :------------------------------ |
| 1   | url   | ![](./img/string.svg) Строковый | http://localhost:11434/api/chat |
| 2   | model | ![](./img/string.svg) Строковый | null                            |

1. **url** — эндпоинт API чата **Ollama**.
2. **model** — идентификатор модели, доступной в **Ollama**.

### Переменные в порте "Параметры"

| №   | Метка       | Тип                                    | Значение по умолчанию |
| :-- | :---------- | :------------------------------------- | :-------------------- |
| 1   | seed        | ![](./img/integer.svg) Целый           | 42                    |
| 2   | temperature | ![](./img/realnumber.svg) Вещественный | 0.7                   |
| 3   | num_predict | ![](./img/integer.svg) Целый           | 1000                  |

1. **seed** — параметр воспроизводимости ответа. По умолчанию `42`.
2. **temperature** — параметр, влияющий на случайность ответов (0-2). По умолчанию `0.7`.
3. **num_predict** —  максимальное количество токенов в ответе. По умолчанию `1000`.

### Переменные в порте "Настройки"

| №   | Метка                               | Тип                               | Значение по умолчанию |
| :-- | :---------------------------------- | :-------------------------------- | :-------------------- |
| 1   | Путь к файлу                        | ![](./img/string.svg) Строковый   | /credentials          |
| 2   | Имя файла                           | ![](./img/string.svg) Строковый   | ollama.params         |
| 3   | Использовать файл                   | ![](./img/logical.svg) Логический | true                  |
| 4   | Формировать кэш                     | ![](./img/logical.svg) Логический | true                  |
| 5   | Кэшированный ответ                  | ![](./img/logical.svg) Логический | false                 |
| 6   | Уникальный идентификатор            | ![](./img/string.svg) Строковый   | Ollama                |
| 7   | Тайм-аут подключения (мс)           | ![](./img/integer.svg) Целый      | 60000                 |
| 8   | Тайм-аут обмена данными (мс)        | ![](./img/integer.svg) Целый      | 60000                 |
| 9   | Игнорировать ошибки SSL сертификата | ![](./img/logical.svg) Логический | true                  |
| 10  | Время задержки между запросами (мс) | ![](./img/integer.svg) Целый      | 0                     |

1. **Путь к файлу** — расположение файла `ollama.params`. По умолчанию в папке `credentials`.
2. **Имя файла** — имя файла, включая расширение файла, в котором указаны реквизиты и параметры. По умолчанию `ollama.params`.
3. **Использовать файл** — использовать реквизиты и параметры из файла. По умолчанию `true`. При значении `false` реквизиты и параметры используются из входных портов.
4. **Формировать кэш** — если флаг `True`, то результат работы компонента будет сохранен в папку `cache` под уникальным идентификатором.
5. **Кэшированный ответ** — если флаг `True`, то вместо обращения к LLM компонент будет воспроизводить последний сохраненный результат.
6. **Уникальный идентификатор** — имя, под которым будет сохраняться результат работы текущего узла.
7. **Тайм-аут подключения (мс)** — максимальное время установки TCP-соединения с сервером в миллисекундах, по истечении которого соединение будет прервано со статусом ошибки. Если параметр равен нулю, то таймаут не ограничен.
8. **Тайм-аут обмена данными (мс)** — максимальное время, которое будет затрачено на отправку HTTP-запроса и получение ответа, по истечении которого обмен будет прерван со статусом ошибки. Если параметр равен нулю, то таймаут не ограничен.
9. **Игнорировать ошибки SSL сертификата** — если данный флаг установлен, то ошибки при проверке сертификата сервера, к которому производится подключение, игнорируются.
10. **Время задержки между запросами (мс)** — время ожидания перед каждым отдельным запросом из списка запросов.

## Выходные порты

| Название      | Тип     |
| :------------ | :------ |
| Ответ         | Таблица |
| Ответ сервера | Таблица |
| Сообщения     | Таблица |
| Кэш           | Таблица |

### Структура таблицы "Ответ"

| Метка | Тип                             | Описание                                     |
| :---- | :------------------------------ | :------------------------------------------- |
| ID    | ![](./img/integer.svg) Целый    | Порядковый идентификатор                     |
| Ответ | ![](./img/string.svg) Строковый | Строка с результатом обработки запроса от LLM|

### Структура таблицы "Ответ сервера"

| Метка         | Тип                             | Описание                                                        |
| :------------ | :------------------------------ | :---------------------------------------------------------------|
| ID            | ![](./img/integer.svg) Целый    | Порядковый идентификатор                                        |
| Ответ сервера | ![](./img/string.svg) Строковый | JSON-строка, содержащая ответ и дополнительную информацию от LLM|

### Структура таблицы "Сообщения"

| Метка                  | Тип                             |
| :--------------------- | :------------------------------ |
| Идентификатор итерации | ![](./img/integer.svg) Целый    |
| Идентификатор запроса  | ![](./img/integer.svg) Целый    |
| Код завершения         | ![](./img/integer.svg) Целый    |
| Описание ошибки        | ![](./img/string.svg) Строковый |
| Код состояния HTTP     | ![](./img/integer.svg) Целый    |

### Структура таблицы "Кэш"

| Метка     | Тип                             | Описание                                                |
| :-------- | :------------------------------ | :------------------------------------------------------ |
| Сообщение | ![](./img/string.svg) Строковый | Статус работы кэша (Сохранение кэша, Кэшированный ответ)|