# Параметры. Структурированный ответ

[Назад к списку компонентов](../README.md)

## Назначение

Компонент для подготовки параметров, использующихся для получения структурированного ответа от LLM.

## Входные порты

| Название          | Тип        |
| :---------------- | :--------- |
| Схема ответа JSON | Переменные |

### Переменные в порте "Схема ответа JSON"

| №   | Метка             | Тип                             | Значение по умолчанию |
| :-- | :---------------- | :------------------------------ | :-------------------- |
| 1   | Схема ответа JSON | ![](./img/string.svg) Строковый | null                  |

1. **Схема ответа JSON** — строка, содержащая валидную JSON Schema, которая описывает структуру ожидаемого ответа от языковой модели. Должна включать обязательные поля **type**, **properties** для объектов, **required** для определения обязательных полей, а также рекомендуется указывать **description** и **examples** для лучшего понимания моделью требуемой структуры.

## Выходные порты

| Название   | Тип        |
| :--------- | :--------- |
| Таблица    | Таблица    |
| Переменные | Переменные |

### Структура таблицы "Таблица"

| Метка | Тип                                 | Описание                                                                      |
| :---- | :---------------------------------- | :---------------------------------------------------------------------------- |
| Name  | ![](./img/string.svg) Строковый     | Имя параметра (format или response_format)                                    |
| Value | ![](./img/undefined.svg) Переменный | Значение параметра в формате JSON, готовое для передачи в соответствующий API |

### Переменные в порте "Переменные"

| №   | Метка           | Тип                             |
| :-- | :-------------- | :------------------------------ |
| 1   | format          | ![](./img/string.svg) Строковый |
| 2   | response_format | ![](./img/string.svg) Строковый |

1. **format** — параметр для **Ollama API**, содержащий исходную **JSON Schema**. Используется напрямую в запросах к локальным моделям через Ollama для принуждения модели к структурированному выводу.

2. **response_format** — параметр для **OpenAI API** и совместимых сервисов, содержащий объект с полями **type: "json_schema"**, **json_schema.strict: true**, и **json_schema.schema** с исходной схемой. Обеспечивает строгое соответствие выходных данных заданной структуре на уровне токенизации.

## Примеры использования

### Входная JSON Schema
```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Feature Description Schema",
  "description": "Схема для описания признаков с формулами и обоснованиями",
  "type": "array",
  "items": {
    "type": "object",
    "required": ["feature_name", "formula", "description"],
    "properties": {
      "feature_name": {
        "type": "string",
        "description": "Название признака/характеристики"
      },
      "formula": {
        "type": "string", 
        "description": "Формула или метод расчета признака"
      },
      "description": {
        "type": "string",
        "description": "Обоснование полезности признака",
        "maxLength": 500
      }
    },
    "additionalProperties": false
  },
  "minItems": 1
}
```

### Выходные параметры

**format** (для Ollama):
```json
// Здесь используется исходная пользовательская JSON Schema
```

**response_format** (для OpenAI):
```json
{
  "type": "json_schema",
  "json_schema": {
    "strict": true,
    "schema": {
      // Здесь используется исходная пользовательская JSON Schema
    }
  }
}
```

## Особенности и ограничения

* Компонент автоматически устанавливает `strict: true` для **OpenAI API**, что требует наличия `additionalProperties: false` во всех объектах схемы
* Поддерживаются основные конструкции JSON Schema: `type`, `properties`, `required`, `items`, `enum`, `minItems`, `maxItems`, `minLength`, `maxLength`