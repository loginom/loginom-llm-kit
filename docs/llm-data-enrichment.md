# LLM. Обогащение данных

[Назад к списку компонентов](../README.md)

## Назначение

Компонент для обогащения данных путем расчета новых признаков на базе сгенерированных признаков из компонента [LLM. Генерация признаков](./llm-feature-generation.md).

Для работы компонента требуется:

1. Установленный на сервере или локальной машине Python версии не ниже 3.9.
2. Указать в настройках Loginom путь к библиотеке **python3x.dll**.
3. Разрешить выполнение узлов Python.
4. Установленная python-библиотека [Pandas](https://pypi.org/project/pandas/).
5. Установленная python-библиотека [NumPy](https://pypi.org/project/numpy/).

## Входные порты

| Название         | Тип        |
| :--------------- | :--------- |
| Список признаков | Таблица    |
| Набор данных     | Таблица    |
| Реквизиты        | Переменные |
| Параметры        | Переменные |
| Настройки        | Переменные |

### Структура таблицы "Список признаков"

| Метка             | Тип                             | Описание |
| :---------------- | :------------------------------ | :------- |
| Имя признака      | ![](./img/string.svg) Строковый | Имя сгенерированного признака на латинице |
| Метод расчета     | ![](./img/string.svg) Строковый | Выражение, описывающее способ расчета нового признака из существующих |
| Описание признака | ![](./img/string.svg) Строковый | Обоснование полезности нового признака |

### Структура таблицы "Набор данных"

На вход принимается набор данных любой структуры.

### Переменные в порте "Реквизиты"

| №   | Метка   | Тип                             | Значение по умолчанию |
| :-- | :------ | :------------------------------ | :-------------------- |
| 1   | url     | ![](./img/string.svg) Строковый | null                  |
| 2   | api_key | ![](./img/string.svg) Строковый | null                  |
| 3   | model   | ![](./img/string.svg) Строковый | null                  |

1. **url** — эндпоинт API чата LLM-сервиса.
2. **api_key** — API-ключ для аутентификации запросов.
3. **model** — идентификатор модели.

### Переменные в порте "Параметры"

| №   | Метка       | Тип                                    | Значение по умолчанию |
| :-- | :---------- | :------------------------------------- | :-------------------- |
| 1   | seed        | ![](./img/integer.svg) Целый           | 42                    |
| 2   | temperature | ![](./img/realnumber.svg) Вещественный | 0.6                   |

1. **seed** — параметр воспроизводимости ответа. По умолчанию `42`.
2. **temperature** — параметр, влияющий на случайность ответов (0-2). По умолчанию `0.7`.

### Переменные в порте "Настройки"

| №   | Метка                               | Тип                               | Значение по умолчанию |
| :-- | :---------------------------------- | :-------------------------------- | :-------------------- |
| 1   | Путь к файлу                        | ![](./img/string.svg) Строковый   | /credentials          |
| 2   | Имя файла                           | ![](./img/string.svg) Строковый   | llm.params            |
| 3   | Использовать файл                   | ![](./img/logical.svg) Логический | true                  |
| 4   | Запрос к Ollama                     | ![](./img/logical.svg) Логический | false                 |
| 5   | Формировать кэш                     | ![](./img/logical.svg) Логический | true                  |
| 6   | Кэшированный ответ                  | ![](./img/logical.svg) Логический | false                 |
| 7   | Уникальный идентификатор кэша       | ![](./img/string.svg) Строковый   | AddingFeatures        |
| 8   | Тайм-аут подключения (мс)            | ![](./img/integer.svg) Целый     | 60000                 |
| 9   | Тайм-аут обмена данными (мс)         | ![](./img/integer.svg) Целый     | 60000                 |
| 10  | Игнорировать ошибки SSL сертификата | ![](./img/logical.svg) Логический | true                  |
| 11  | Время задержки между запросами (мс) | ![](./img/integer.svg) Целый      | 0                     |

1. **Путь к файлу** — расположение файла `llm.params`. По умолчанию в папке `credentials`.
2. **Имя файла** — имя файла, включая расширение файла, в котором указаны реквизиты и параметры. По умолчанию `llm.params`.
3. **Использовать файл** — использовать реквизиты и параметры из файла. По умолчанию `true`. При значении `false` реквизиты и параметры используются из входных портов.
4. **Запрос к Ollama** — если вы используете `Ollama API`, то необходимо указать флаг `true`. По умолчанию `false`.
5. **Формировать кэш** — если флаг `True`, то результат работы компонента будет сохранен в папку `cache` под уникальным идентификатором.
6. **Кэшированный ответ** — если флаг `True`, то вместо обращения к LLM компонент будет воспроизводить последний сохраненный результат.
7. **Уникальный идентификатор** — имя, под которым будет сохраняться результат работы текущего узла.
8. **Тайм-аут подключения (мс)** — максимальное время установки TCP-соединения с сервером в миллисекундах, по истечении которого соединение будет прервано со статусом ошибки. Если параметр равен нулю, то таймаут не ограничен.
9. **Тайм-аут обмена данными (мс)** — максимальное время, которое будет затрачено на отправку HTTP-запроса и получение ответа, по истечении которого обмен будет прерван со статусом ошибки. Если параметр равен нулю, то таймаут не ограничен.
10. **Игнорировать ошибки SSL сертификата** — если данный флаг установлен, то ошибки при проверке сертификата сервера, к которому производится подключение, игнорируются.
11. **Время задержки между запросами (мс)** — время ожидания перед каждым отдельным запросом из списка запросов.

## Выходные порты

| Название                           | Тип     |
| :--------------------------------- | :------ |
| Набор данных (с новыми признаками) | Таблица |
| Список признаков                   | Таблица |
| Сообщения                          | Таблица |

### Структура таблицы "Набор данных (с новыми признаками)"

Исходный набор данных с рассчитанными новыми признаками.

### Структура таблицы "Список признаков"

| Метка         | Тип                             | Описание |
| :------------ | :------------------------------ | :------- |
| Имя признака  | ![](./img/string.svg) Строковый | Имя сгенерированного признака на латинице |
| Метод расчета | ![](./img/string.svg) Строковый | Python-выражение для рассчета нового признака из существующих | 

### Структура таблицы "Сообщения"

| Метка                  | Тип                             |
| :--------------------- | :------------------------------ |
| Идентификатор итерации | ![](./img/integer.svg) Целый    |
| Идентификатор запроса  | ![](./img/integer.svg) Целый    |
| Код завершения         | ![](./img/integer.svg) Целый    |
| Описание ошибки        | ![](./img/string.svg) Строковый |
| Код состояния HTTP     | ![](./img/integer.svg) Целый    |
